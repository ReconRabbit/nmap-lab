# Dockerfile.node
FROM ubuntu:22.04
ENV DEBIAN_FRONTEND=noninteractive

ARG USERNAME=demo
ARG PASSWORD=demo

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
      openssh-server iproute2 iputils-ping net-tools iptables \
      ncat curl inetutils-traceroute dnsutils nmap \
      netcat-openbsd && \
    rm -rf /var/lib/apt/lists/*

# create ssh run dir
RUN mkdir /var/run/sshd

# ensure sshd allows password auth (so the password will work)
RUN sed -i 's/^#*PasswordAuthentication .*/PasswordAuthentication yes/' /etc/ssh/sshd_config || true
RUN sed -i 's/^#*PermitRootLogin .*/PermitRootLogin no/' /etc/ssh/sshd_config || true

# create the user using build args, set the password, and give them a home
RUN useradd -m -s /bin/bash ${USERNAME} && \
    echo "${USERNAME}:${PASSWORD}" | chpasswd && \
    mkdir -p /home/${USERNAME}/.ssh && chown -R ${USERNAME}:${USERNAME} /home/${USERNAME}
RUN usermod -aG sudo ${USERNAME}
RUN apt update && \
        DEBIAN_FRONTEND=noninteractive apt install -y sudo

# copy entrypoint and make executable
COPY entrypoint-node.sh /entrypoint-node.sh
COPY dockerfile3.sh /dockerfile3.sh
RUN chmod +x /entrypoint-node.sh /dockerfile3.sh


EXPOSE 9 21 22 23 80 53 143 443 5900 8000 8080 

CMD ["/entrypoint-node.sh"]
